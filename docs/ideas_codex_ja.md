# AI Vtuber Phase 2 アイデア案 — Codex
**日付**: 2025-12-26 (推定)

---

## 1. 現状分析 (強み / 弱み)

**強み**
- **モジュラーなインターフェース**: `IChatAdapter`, `ILLMService`, `ITTSService` などが綺麗に分離されており、拡張が容易。
- **決定論的なフロー**: `TopicSpine` と `CommentRouter` により、カオスなチャットでも進行が崩れにくい。
- **運用ハイジーン**: リトライ処理、エラー抑制、フォールバックキューなど、MVP時点で安定運用への配慮がある。

**弱み**
- **永続性の欠如**: 再起動すると、視聴者や話題、スタイルの記憶が全て消える。
- **文脈の狭さ**: LLMへの入力が「直前の1コメント」のみで、会話の継続性がない。
- **静的な人格**: プロンプトが固定されており、長時間配信だと単調になる。
- **音声のみ**: 視覚情報がなく、トップティアのVtuberに比べて「配信の価値」が低い。
- **相互作用の薄さ**: チャット→音声の一方通行のみで、ゲームやオーバーレイ等のギミックがない。

---

## 2. 提案機能 (3–5選)

### 機能A: 永続的記憶と検索 (セッション + 長期記憶)
**コンセプト**: チャットの要約、視聴者プロファイル、過去の話題をDBに保存し、発話時に検索して活用する。
**価値**: AIが視聴者や過去のネタを「覚えている」ことで、配信に個人的なつながりと継続性が生まれる。
**技術アプローチ**:
- **SQLite + Prisma** (またはPostgres) で永続化層を追加。
- `viewer_id`, `display_name`, `facts` (視聴者情報), `topic_summary` 等を保存。
- **OpenAI embeddings** と **pgvector/sqlite-vec** でベクトル検索を実装。
- `MemoryService` を作成し、応答生成前に「関連する記憶」をプロンプトに注入する。

### 機能B: コンテキストマネージャー & ロール要約
**コンセプト**: トークン予算を管理した「会話履歴バッファ」を持ち、古い会話を自動要約して保持する。
**価値**: 数分間にわたる文脈の通った会話が可能になり、「なんでさっきの話無視したの？」が減る。
**技術アプローチ**:
- `ConversationBuffer` を実装し、トークン数上限管理と自動要約を行う。
- GPT-4o-mini 等で古いターンを要約して圧縮保存。
- `PromptManager` でこれをプロンプトに組み込む。

### 機能C: 動的ペルソナ & ムードエンジン
**コンセプト**: 気分、エネルギー、配信目標を持つ「PersonaState」を導入し、時間とともに変化させる。
**価値**: 感情の起伏がある「キャラクター」らしくなり、単調さを回避できる。
**技術アプローチ**:
- `PersonaState` (mood, energy, pace, humor) を定義し、tickごとに更新。
- チャットの感情分析（Sentiment）等でステートを変化させる。
- VOICEVOXのパラメータ（style/pitch/speed）をStateに合わせて動的に変更。

### 機能D: Live2D/OBS 統合による視覚表現
**コンセプト**: Live2Dアバターを表示し、チャットや感情に合わせて表情や動きを制御する。
**価値**: 真のVtuber体験を提供。視覚的フィードバックで感情が伝わりやすくなる。
**技術アプローチ**:
- **VTube Studio API** (WebSocket) または **Live2D Web Viewer** を使用。
- **obs-websocket-js** でOBSのシーンやソースを制御。
- `AvatarService` を作り、`PersonaState` を表情コマンドに変換して送信。

### 機能E: インタラクティブ・ストリーム・トイズ (ミニゲームとトリガー)
**コンセプト**: チャットコマンドでミニゲームや演出をトリガーできるようにする。
**価値**: 参加感が強まり、コメントするモチベーションが上がる。
**技術アプローチ**:
- `InteractionRegistry` にコマンド (`!dice`, `!poll` 等) を登録。
- シンプルなステートマシンでゲーム進行を管理。
- 結果をOBS上のHTMLオーバーレイに表示。

---

## 3. ロードマップ (2週間スプリント: Day 7–14)

**Day 7–8: 永続化と記憶の基盤**
- Prismaスキーマ策定 (`viewer`, `session`, `memory` テーブル)。
- MemoryService実装、Agentへの統合。

**Day 9–10: コンテキスト管理と要約**
- ConversationBuffer実装。トークンカウントと要約ロジック。
- プロンプトへの履歴注入。

**Day 11–12: ペルソナとTTS表現**
- PersonaStateと感情による更新ロジック。
- VOICEVOXパラメータへのマッピングとテスト。

**Day 13: 視覚統合プロトタイプ**
- VTube Studio API または Live2Dオーバーレイの導入。
- AvatarService（最小限の表情変更）の実装。

**Day 14: インタラクティブ機能 & 仕上げ**
- チャットコマンド (サイコロ、投票など) 実装。
- ドキュメント整備、通しリハーサル。

---

## 4. "Killer" Idea (キラーアイデア)

### **「オーディエンス・コパイロット」ライブ・ストーリークラフティング**

**コンセプト**:
メインのAIエージェントとは別に、「ストーリー監督AI」を並走させる。
監督AIは、チャットの投票やムードに基づいて、配信全体の「物語アーク（起承転結、ミステリー、冒険など）」をリアルタイムに構築・修正する。
メインAIはそのアークの中でアドリブで演技・トークを行い、監督AIは次なる展開（クリフハンガーや伏線回収）をプロンプトで指示する。

**差別化要因**:
単なる雑談ではなく、**「毎回がドラマの1エピソード」**のような体験になる。
「次はどうなるの？」「見逃せない」という感覚を視聴者に与え、継続視聴率を高める。

**作り方**:
- `StoryDirectorService` を実装し、数分おきに物語の進行状況(`Arc`)を更新。
- チャットコマンド `!vote` で展開分岐を投票。
- 監督AIが次の展開指示（Next Beat）をメインAIのプロンプトに注入。
- (Option) 画面上に現在の「クエスト」や「目的」を表示する。
